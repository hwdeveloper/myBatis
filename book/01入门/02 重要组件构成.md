### 一，概述


### 二，基础的组件
- SqlSessionFactoryBuilder 创建出sqlSessionFactory时销毁
- SqlSessionFactory 不用销毁
- SqlSession  close()时销毁
- Mapper 当session销毁时，mapper销毁

### 三，SqlSessionFactoryBuilder
##### (1)对象创建直接使用无参构造方法

```
SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();
```
##### (2)该对象的唯一作用就是创建一个SqlSessionFactory
通过mybatis配置文件(或纯java)创建SqlSessionFactory对象

```
SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();
//参数是mybatis配置文件路径
InputStream inputStream = Resources.getResourceAsStream("mybatis/mybatis.xml");
SqlSessionFactory factory=builder.build(inputStream); 
```
##### (3)销毁
SqlSessionFactoryBuilder一但创建了SqlSessionFactory后，SqlSessionFactoryBuilder对象就会被立刻销毁。即不能使用同一个SqlSessionFactoryBuilder对象创建两次SqlSessionFactory对象。

```
SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();
InputStream inputStream = Resources.getResourceAsStream("mybatis/mybatis.xml");
SqlSessionFactory factory1 = builder.build(inputStream);
//会有异常，因为builder只能创建一次SqlSessionFactory对象
SqlSessionFactory factory2 = builder.build(inputStream);//异常
```
### 四，SqlSessionFactory
- 由SqlSessionFactoryBuilder对象创建
- 作用是创建SqlSession,同一个SqlSessionFactory对象可以创建多个SqlSession
- 在实计的开发中建议把SqlSessionFactory以单例形式存在


```
public class DBUtil {
   private static SqlSessionFactory factory = null;
   public static SqlSessionFactory getSqlSessionFactory() {
      try {
         if (factory == null) {
            SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();
            InputStream inputStream = Resources.getResourceAsStream("mybatis/mybatis.xml");
            factory = builder.build(inputStream);
         }
      } catch (IOException e) {
         e.printStackTrace();
         return null;
      }
      return factory;
   }
}
```
### 五，SqlSession
- SqlSessionFactory创建
- 创建Mapper对象,每次创建都是一个新的Mapper对象

重要方法
- getMapper()得到Mapper接口的代理实现类对象
- commit()提交增删改要提交,查询提交也没有错，但是没有发生任何事儿
- rollback()回滚  
- close()关闭
- flush()刷新

### 六，Mapper
##### (1)调用Mapper接口中声明的方法操作对数据库的操作
事务处理1
```
SqlSession session = DBUtil.getSqlSessionFactory().openSession();
Teacher teacher = new Teacher("老子", "男", 23, "123");
TeacherMapper teacherMapper = session.getMapper(TeacherMapper.class);
teacherMapper.insertTeacher(teacher);
session.commit();//提交
session.close();
```
事务处理2

```
 SqlSession session = DBUtil.getSqlSessionFactory().openSession();
      TeacherMapper teacherMapper = session.getMapper(TeacherMapper.class);
      try {
        teacherMapper.insertTeacher(new Teacher("妻子","女",20, "123"));
        teacherMapper.insertTeacher(new Teacher("老公", "男", 23, "123"));
        session.commit();//提交
      } catch (Exception e) {
        e.printStackTrace();
        session.rollback();//回滚
      }finally {
       	 	session.close();//关闭
      }
```